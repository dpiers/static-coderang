<head>
  <meta charset="utf-8" />
  <!-- Include Firebase -->
  <script src="//cdn.firebase.com/v0/firebase.js"></script>

  <!-- Include CodeMirror -->
  <script src="codemirror/lib/codemirror.js"></script>
  <link rel="stylesheet" href="codemirror/lib/codemirror.css" />
  <link rel="stylesheet" href="codemirror/theme/neat.css">

  <!-- Include CodeMirror Language Modes -->
  <script src="codemirror/mode/javascript/javascript.js"></script>
  <script src="codemirror/mode/ruby/ruby.js"></script>
  <script src="codemirror/mode/python/python.js"></script>

  <!-- Include Firepad -->
  <script src="firepad/firepad.js"></script>
  <link rel="stylesheet" href="firepad/firepad.css" />

  <!-- Include example userlist. -->
  <script src="firepad/firepad-userlist.js"></script>
  <link rel="stylesheet" href="firepad/firepad-userlist.css" />

  <!-- Include JQuery and JQConsole -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.8.6/jquery-ui.min.js"></script>
  <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.23/themes/base/jquery-ui.css"/>
  <script src="jquery/jquery.console.js"></script>

  <!-- Include JSRepl -->
  <script src="jsrepl/jsrepl.js" id="jsrepl-script"></script>


  <!-- Include TokBox 
  <script type="text/javascript" src="https://www.tokbox.com/webrtc/v2.0/js/TB.min.js"></script>
  <script src="videoChatTokBox.js" type="text/javascript"></script>-->

  <!-- Include custom CSS -->
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="title">
    coderang
  </div>
  <div class="main">
    <div class="firePower">
        <div class="sidebar">
          <div id="videoChat"></div>
          <div id="userlist"></div>
          <div id="chat">
            <div class="messages">aaa</div>
            <div class="reply">
              <input type="text" id="messageInput" placeholder="Say something...">
            </div>
          </div>
        </div>
        
        <div id="firepad"></div>
    </div>
    <div class="console"> </div>
  </div>

  <script>
    //// Initialize Firebase.

    var randomDocName = function(length) {
      var chars, x;
      if (length == null) {
        length = 10;
      }
      chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-=";
      var name = [];
      for (x = 0; x < length; x++) {
        name.push(chars[Math.floor(Math.random() * chars.length)]);
      }
      return name.join('');
    };

    if (!document.location.hash) {
      document.location.hash = '#' + randomDocName();
    }
    var docName = document.location.hash.slice(1);

    var firebaseRef = new Firebase('https://coderang.firebaseio.com/' + docName);

    //// Create CodeMirror (with lineWrapping on).
    var codeMirror = CodeMirror(document.getElementById('firepad'), { 
      lineWrapping: true,
      lineNumbers: true,
      mode: 'python',
      theme: 'neat'
    });

    // Create a random ID to use as our user ID (we must give this to firepad and FirepadUserList).
    var userId = Math.floor(Math.random() * 9999999999).toString();

    //// Create Firepad (with rich text features and our desired userId).
    var firepad = Firepad.fromCodeMirror(firebaseRef, codeMirror,
      {userId: userId});

    //// Create FirepadUserList (with our desired userId).
    var firepadUserList = FirepadUserList.fromDiv(firebaseRef.child('users'),
        document.getElementById('userlist'), userId);

    //// Initialize contents.
    firepad.on('ready', function() {
      if (firepad.isHistoryEmpty()) {
        firepad.setText('# Python editor!\n\nclass Person:\n    def __init__(self, name):\n    self.name = name\n\ndef say_hello(name):\n    print "Hello %s!" % name\n\nm = Person("World")\n\nsay_hello(m.name)');
      }
    });

    //var tb = new TBStart("28217822", "videoChat");
    //tb.startVideo();

    resultCallback = function(result) {
      if (result) {
        if (result[-1] !== '\n') {
          result = result + '\n';
        }
        jqconsole.commandResult(result, 'answer');
      }
      else {
        jqconsole.commandResult();
      }
      return;
    }

    errorCallback = function(error) {
      if (typeof error === 'object') {
        error = error.message;
      }
      if (error[-1] !== '\n') {
        error = error + '\n';
      }
      jqconsole.commandResult(String(error), 'error');
      return;
    }
    
    outputCallback = function(output, cls) {
      if (output) {
        jqconsole.commandResult(output, 'answer');
        JSREPL.$this.trigger('output', [output]);
        return void 0;
      }
    }
    
    inputCallback = function(callback) {
      jqconsole.Input(function(result) {
        try {
          callback(result);
          return JSREPL.$this.trigger('input', [result]);
        } catch (e) {
          return errorCallback(e);
        }
      });
      return void 0;
    }

    progressCallback = function(percentage) {
          return;
    }

    timeoutCallback = function() {
      return;
    }

    window.jsrepl = new JSREPL({  
        input: inputCallback,  
        output: outputCallback,  
        result: resultCallback,  
        error: errorCallback,  
        progress: progressCallback,  
        timeout: {  
          time: 30000,  
          callback: timeoutCallback  
        }
    });

    jsrepl.loadLanguage('python');

    /* Initialize console */
    window.jqconsole = $('.console').console({
     promptLabel: '> ',
     commandHandle:function(line){
      jsrepl.eval(String(line));
      return;
     },
     cols: 40,
     completeHandle:function(prefix){
     },
     animateScroll:true,
     promptHistory:true,
    })

  </script>

  <script>
    $(document).ready(function() {
      // init
      var leftPanel = $(".console");
      var resize= $(".console");
      var containerHeight = $(".main").height();
          
      $(resize).resizable({
            handles: 'n',
            maxHeight: 450,
            minHeight: 120,
            resize: function(event, ui){
                var currentHeight = ui.size.height;
                
                // this accounts for padding in the panels + 
                // borders, you could calculate this using jQuery
                var padding = 12; 
                
                // this accounts for some lag in the ui.size value, if you take this away 
                // you'll get some instable behaviour
                $(this).height(currentHeight);
                $(this).css("top", 0);
                $(this).css("bottom", 0);
                
                // set the content panel width
                $(".firePower").height(containerHeight - currentHeight - padding);            
            }
      });


      var ctlDiv = $('<div class="controls"></div>');
      var select = $('<div id="select">Change Language</div>');
      var run = $('<div id="run">Run...</div>');

      ctlDiv.append(select);
      ctlDiv.append(run);

      $('.firepad').append(ctlDiv);
    });

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-40647192-1', 'coderang.com');
    ga('send', 'pageview');
  </script>
</body>